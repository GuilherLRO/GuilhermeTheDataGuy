# Monthly Trends Analysis Report

This report documents the exploration of monthly aggregated retail data using SQLite.

## Data Schema

The data is stored in a table named `trends` with the following columns:

| Column | Type | Description |
|--------|------|-------------|
| month | DATE | Monthly timestamp (YYYY-MM-DD) |
| merchant | TEXT | Retailer name |
| l1 | TEXT | Category Level 1 (Apparel, Footwear, etc.) |
| l2 | TEXT | Category Level 2 (Tops, Bottoms, etc.) |
| l3 | TEXT | Category Level 3 (Specific product types) |
| gender | TEXT | Target gender (Men's, Women's, Kids, etc.) |
| fop | TEXT | Form of Product |
| sub_sport | TEXT | Sport subcategory |
| gmv | REAL | Gross Merchandise Value |
| source | TEXT | Data source indicator (new, old) |

---

## Table of Contents

1. [Comparative Analysis of Merchant Presence Across Data Versions (Old vs. New)](#question-1-comparative-analysis-of-merchant-presence-across-data-versions-old-vs.-new)
2. [Comparative Analysis of FOP Taxonomy and Row Distribution (Old vs. New)](#question-2-comparative-analysis-of-fop-taxonomy-and-row-distribution-old-vs.-new)
3. [Nike Market Share Analysis in Basketball Footwear (Original Delivery Scope)](#question-3-nike-market-share-analysis-in-basketball-footwear-original-delivery-scope)
4. [Merchant Market Share Distribution in Basketball Footwear (Original Delivery Scope)](#question-4-merchant-market-share-distribution-in-basketball-footwear-original-delivery-scope)
5. [Merchant Market Share Distribution in Sportswear (Original Delivery Scope)](#question-5-merchant-market-share-distribution-in-sportswear-original-delivery-scope)
6. [Merchant Market Share Distribution in Training (Original Delivery Scope)](#question-6-merchant-market-share-distribution-in-training-original-delivery-scope)
7. [Merchant Market Share Distribution in Running (Original Delivery Scope)](#question-7-merchant-market-share-distribution-in-running-original-delivery-scope)
8. [Merchant Market Share Distribution in Basketball (Original Delivery Scope)](#question-8-merchant-market-share-distribution-in-basketball-original-delivery-scope)
9. [Merchant Market Share Distribution in Hiking (Original Delivery Scope)](#question-9-merchant-market-share-distribution-in-hiking-original-delivery-scope)
10. [Merchant Market Share in Sportswear Apparel (Valid L2, Original Scope)](#question-10-merchant-market-share-in-sportswear-apparel-valid-l2-original-scope)
11. [Merchant Market Share in Training Apparel (Valid L2, Original Scope)](#question-11-merchant-market-share-in-training-apparel-valid-l2-original-scope)
12. [Merchant Market Share in Basketball Apparel (Valid L2, Original Scope)](#question-12-merchant-market-share-in-basketball-apparel-valid-l2-original-scope)
13. [Merchant Market Share in Hiking Apparel (Valid L2, Original Scope)](#question-13-merchant-market-share-in-hiking-apparel-valid-l2-original-scope)
14. [Merchant Market Share in Cheer/Dance Apparel (Valid L2, Original Scope)](#question-14-merchant-market-share-in-cheerdance-apparel-valid-l2-original-scope)

---

## Question 1: Comparative Analysis of Merchant Presence Across Data Versions (Old vs. New)
*Raw question: Which are the merchants in each version? what changed?*

### Reasoning
The goal is to identify which merchants exist in the "old" vs "new" data sources. By using a FULL OUTER JOIN simulation (using UNION of distinct merchants) or a conditional aggregation, we can see presence markers for each version without focusing on financial metrics like GMV.

### SQL Query
```sql

SELECT 
    merchant,
    MAX(CASE WHEN source = 'old' THEN 1 ELSE 0 END) as in_old,
    MAX(CASE WHEN source = 'new' THEN 1 ELSE 0 END) as in_new,
    CASE 
        WHEN MAX(CASE WHEN source = 'old' THEN 1 ELSE 0 END) = 1 AND MAX(CASE WHEN source = 'new' THEN 1 ELSE 0 END) = 0 THEN 'Removed in New'
        WHEN MAX(CASE WHEN source = 'old' THEN 1 ELSE 0 END) = 0 AND MAX(CASE WHEN source = 'new' THEN 1 ELSE 0 END) = 1 THEN 'Added in New'
        ELSE 'Present in Both'
    END as status
FROM trends
WHERE merchant != 'merchant'
GROUP BY merchant
ORDER BY status, merchant;

```

### Results

| merchant              |   in_old |   in_new | status          |
|:----------------------|---------:|---------:|:----------------|
| abercrombie_and_fitch |        0 |        1 | Added in New    |
| amazon_leia           |        0 |        1 | Added in New    |
| costco                |        0 |        1 | Added in New    |
| lululemon             |        0 |        1 | Added in New    |
| macys                 |        0 |        1 | Added in New    |
| nordstrom             |        0 |        1 | Added in New    |
| scheels               |        0 |        1 | Added in New    |
| academy_sports        |        1 |        1 | Present in Both |
| champs_sports         |        1 |        1 | Present in Both |
| dicks_sporting_goods  |        1 |        1 | Present in Both |
| foot_locker           |        1 |        1 | Present in Both |
| hoka                  |        1 |        1 | Present in Both |
| kids_foot_locker      |        1 |        1 | Present in Both |
| kohls                 |        1 |        1 | Present in Both |
| nike                  |        1 |        1 | Present in Both |
| on                    |        1 |        1 | Present in Both |
| target                |        1 |        1 | Present in Both |

### Summary Analysis
**Data Scope Expansion Alert**: The new delivery added 7 major retailers (Amazon Leia, Costco, Nordstrom, Macy's, Lululemon, Abercrombie & Fitch, Scheels) that were completely absent from the old delivery. This represents a ~70% expansion in merchant coverage (from 10 to 17 total merchants). **Critical Implication**: Any aggregate YoY trends will be heavily biased by this scope change. When comparing versions, we must restrict to the 10 common merchants to avoid conflating market growth with data source expansion. The addition of major general retailers (Amazon, Costco) versus specialty athletic retailers suggests a shift toward capturing broader "athleisure" market dynamics.

---

## Question 2: Comparative Analysis of FOP Taxonomy and Row Distribution (Old vs. New)
*Raw question: re do the qeustion again, but now add a cout or rows for eah fop*

### Reasoning
This analysis combines normalization of FOP values with row counts. By looking at the number of records for each normalized FOP category in both versions, we can see if the data volume has changed significantly, which might indicate better coverage or a change in granularity.

### SQL Query
```sql
[Counts performed in Python with normalization: lowercase, singularize, and map generic terms]
```

### Results

| normalized        |   old_row_count |   new_row_count | status          |
|:------------------|----------------:|----------------:|:----------------|
| sportswear        |           43799 |          117750 | Present in Both |
| training          |           28866 |           81260 | Present in Both |
| running           |           24513 |           43689 | Present in Both |
| basketball        |           17351 |           53589 | Present in Both |
| soccer            |           11627 |           41395 | Present in Both |
| golf              |           10529 |           21542 | Present in Both |
| hiking outdoor    |           10209 |           28025 | Present in Both |
| baseball          |            7848 |           19568 | Present in Both |
| american football |            7727 |           12092 | Present in Both |
| tennis            |            5525 |           28212 | Present in Both |
| softball          |            3828 |           12588 | Present in Both |
| volleyball        |            3742 |           14584 | Present in Both |
| slides            |            3490 |           13103 | Present in Both |
| lacrosse          |            2229 |            5394 | Present in Both |
| flip flop         |            1322 |            6048 | Present in Both |
| wrestling         |            1069 |            8113 | Present in Both |
| pickleball        |             678 |            2186 | Present in Both |
| walking           |             664 |            4085 | Present in Both |
| cheer dance       |             370 |           29997 | Present in Both |
| boxing            |             290 |            2939 | Present in Both |
| swimming          |               0 |           19350 | Added in New    |
| field hockey      |               0 |           12660 | Added in New    |
| gymnastics        |               0 |            9790 | Added in New    |
| rugby             |               0 |            8705 | Added in New    |
| ski snowboard     |               0 |            7862 | Added in New    |
| cricket           |               0 |            5509 | Added in New    |
| outdoor sandal    |               0 |            1752 | Added in New    |

### Visualization
![Comparative Analysis of FOP Taxonomy and Row Distribution (Old vs. New)](images/fop_row_counts.png)

### Summary Analysis
**Data Granularity Explosion**: Total row count increased by 229.5% (175,876 → 579,441 rows), but this is not uniform. Most concerning: Cheer/Dance exploded from 370 to 29,997 rows (81x multiplier), while Tennis grew from 5,525 to 28,212 (5.1x). Seven entirely new categories appeared (Swimming, Field Hockey, Gymnastics, Rugby, Ski/Snowboard, Cricket, Outdoor Sandals). **Analytical Concern**: This level of disparity suggests the old delivery was severely underreporting niche sports categories. The Cheer/Dance anomaly is particularly suspect—either the old version was nearly missing this category entirely, or the new version is overcounting through taxonomy changes. Recommend validating Cheer/Dance classification logic before trusting any analysis in this category.

---

## Question 3: Nike Market Share Analysis in Basketball Footwear (Original Delivery Scope)
*Raw question: Let's select one specific fop, lets say 'basketball'. considering only the months and merchants that were present in the first delivery calculate the market share of Nike where l1 = 'footwear'.*

### Reasoning
To calculate a comparable market share, we first identify the intersection of months and merchants available in the original "old" delivery. We then filter the "new" data (to see the most recent performance) for the "Basketball" category and "Footwear" L1, calculating Nike's GMV relative to the total GMV in that specific subset.

### SQL Query
```sql

WITH scope AS (
    SELECT DISTINCT month, merchant 
    FROM trends 
    WHERE source = 'old'
),
filtered_data AS (
    SELECT 
        t.source,
        t.merchant,
        t.gmv
    FROM trends t
    JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
    WHERE (LOWER(t.fop) = 'basketball' OR t.fop = 'Basketball')
      AND LOWER(t.l1) = 'footwear'
)
SELECT 
    source,
    SUM(CASE WHEN merchant = 'nike' THEN gmv ELSE 0 END) as nike_gmv,
    SUM(gmv) as total_gmv,
    ROUND(SUM(CASE WHEN merchant = 'nike' THEN gmv ELSE 0 END) * 100.0 / SUM(gmv), 2) as nike_market_share_pct
FROM filtered_data
GROUP BY source;

```

### Results

| source   |    nike_gmv |   total_gmv |   nike_market_share_pct |
|:---------|------------:|------------:|------------------------:|
| new      | 2.65475e+09 | 4.995e+09   |                   53.15 |
| old      | 2.73204e+09 | 5.38599e+09 |                   50.72 |

### Visualization
![Nike Market Share Analysis in Basketball Footwear (Original Delivery Scope)](images/nike_basketball_share.png)

### Summary Analysis
**Nike's Basketball Dominance Strengthens**: Nike increased market share from 50.72% to 53.15% (+2.43 points) in Basketball Footwear. However, the total market GMV decreased from $5.39B to $5.00B (-7.2%). **Key Insight**: Nike is gaining share in a *shrinking* pie within the identical merchant/time scope. This suggests competitors lost both absolute dollars AND relative position. The market contraction could indicate: (1) the new version has stricter Basketball classification criteria, excluding borderline items, or (2) there's a genuine downturn in this category that Nike is weathering better than competitors.

---

## Question 4: Merchant Market Share Distribution in Basketball Footwear (Original Delivery Scope)
*Raw question: Question 4: now lets make this same analysis for all merchants in the first delivery for Basketball and foortwear*

### Reasoning
This analysis expands the market share calculation to all merchants within the Basketball Footwear category. We maintain the original scope (months and merchants present in the "old" delivery). To facilitate comparison, the results are pivoted to show "old" and "new" market shares in adjacent columns.

### SQL Query
```sql

WITH scope AS (
    SELECT DISTINCT month, merchant 
    FROM trends 
    WHERE source = 'old'
),
filtered_data AS (
    SELECT 
        t.source,
        t.merchant,
        t.gmv
    FROM trends t
    JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
    WHERE (LOWER(t.fop) = 'basketball' OR t.fop = 'Basketball')
      AND LOWER(t.l1) = 'footwear'
),
totals AS (
    SELECT source, SUM(gmv) as total_gmv
    FROM filtered_data
    GROUP BY source
),
shares AS (
    SELECT 
        d.merchant,
        d.source,
        SUM(d.gmv) * 100.0 / t.total_gmv as share
    FROM filtered_data d
    JOIN totals t ON d.source = t.source
    GROUP BY d.merchant, d.source, t.total_gmv
)
SELECT 
    merchant,
    ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
    ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
    ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
FROM shares
GROUP BY merchant
ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;

```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| nike                 |           50.72 |           53.15 |         2.42 |
| dicks_sporting_goods |           21.99 |            8.07 |       -13.92 |
| foot_locker          |           12.77 |           20.13 |         7.36 |
| champs_sports        |            5.22 |            5.88 |         0.66 |
| kohls                |            3.97 |            5.66 |         1.69 |
| academy_sports       |            3.23 |            3.74 |         0.51 |
| kids_foot_locker     |            2.08 |            2.57 |         0.5  |
| target               |            0.01 |            0.07 |         0.06 |
| on                   |            0    |            0.72 |         0.72 |

### Visualization
![Merchant Market Share Distribution in Basketball Footwear (Original Delivery Scope)](images/merchant_basketball_shares_pivoted.png)

### Summary Analysis
**Major Attribution Correction for Dick's Sporting Goods**: Dick's Sporting Goods experienced a catastrophic 13.92 percentage point decline (21.99% → 8.07%) in Basketball Footwear, while Foot Locker surged by 7.36 points (12.77% → 20.13%). **Root Cause Hypothesis**: This is unlikely to reflect actual market dynamics—the time and merchant scope are identical. More probable explanations: (1) The old version was incorrectly attributing Foot Locker-branded Basketball shoes sold at Dick's locations to Dick's instead of Foot Locker, (2) The new version has better brand-level SKU attribution, correctly routing Nike/Jordan products sold at Dick's to the Nike total, reducing Dick's share. **Action Item**: Investigate whether Dick's is now being measured primarily on Dick's private-label basketball shoes only.

---

## Question 5: Merchant Market Share Distribution in Sportswear (Original Delivery Scope)
*Raw question: Market share analysis for Sportswear*

### Reasoning
Analyzing the competitive landscape for Sportswear across all merchants, restricted to the months and merchants present in the original "old" delivery to isolate data version effects.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%sportswear%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| nike                 |           38.01 |           27.76 |       -10.25 |
| dicks_sporting_goods |           15.02 |            8.97 |        -6.04 |
| foot_locker          |           14.77 |            9.65 |        -5.11 |
| kohls                |           11.01 |           18.51 |         7.51 |
| champs_sports        |            6.43 |            4.06 |        -2.37 |
| academy_sports       |            5.73 |            3.48 |        -2.24 |
| target               |            5.55 |           25.22 |        19.67 |
| kids_foot_locker     |            3.34 |            2.05 |        -1.3  |
| on                   |            0.09 |            0.27 |         0.18 |
| hoka                 |            0.05 |            0.01 |        -0.04 |

### Visualization
![Merchant Market Share Distribution in Sportswear (Original Delivery Scope)](images/merchant_sportswear_shares.png)

### Summary Analysis
**Target Emerges as Sportswear Giant**: In the Sportswear category, Target skyrocketed from 5.55% to 25.22% (+19.67 points), becoming the #1 merchant, while Nike dropped from 38.01% to 27.76% (-10.25 points) and Dick's fell from 15.02% to 8.97% (-6.04 points). **Critical Analysis**: This is the most dramatic redistribution observed. Target's gain is nearly double Nike's loss, suggesting this is not a zero-sum reallocation. Possible explanations: (1) The new version is capturing Target's private-label activewear (All in Motion, JoyLab) that was previously uncategorized, (2) The old version was severely undercounting general merchandise retailers in favor of specialty sports stores. **Data Quality Flag**: Nike dropping from #1 to #2 in Sportswear—the broadest athletic category—warrants validation with external market research.

---

## Question 6: Merchant Market Share Distribution in Training (Original Delivery Scope)
*Raw question: Market share analysis for Training*

### Reasoning
Analyzing the competitive landscape for Training across all merchants, restricted to the months and merchants present in the original "old" delivery to isolate data version effects.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%training%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| dicks_sporting_goods |           27.01 |           14.68 |       -12.33 |
| target               |           24.59 |           45.47 |        20.88 |
| kohls                |           20.5  |           25.45 |         4.95 |
| nike                 |           15.6  |            8.36 |        -7.24 |
| academy_sports       |           10.74 |            5.31 |        -5.43 |
| foot_locker          |            0.68 |            0.47 |        -0.22 |
| champs_sports        |            0.65 |            0.19 |        -0.46 |
| kids_foot_locker     |            0.14 |            0.02 |        -0.12 |
| hoka                 |            0.08 |            0.04 |        -0.04 |
| on                   |            0.01 |            0.01 |        -0    |

### Visualization
![Merchant Market Share Distribution in Training (Original Delivery Scope)](images/merchant_training_shares.png)

### Summary Analysis
**Target Dominates Training Even More Dramatically**: Target jumped from 24.59% to 45.47% (+20.88 points), now controlling nearly half the Training category market share. Dick's Sporting Goods collapsed from 27.01% to 14.68% (-12.33 points), and Nike fell from 15.60% to 8.36% (-7.24 points). **Pattern Recognition**: This is the second consecutive category where Target has gained 20+ points. The consistency suggests systematic underreporting in the old delivery rather than random error. Training is heavily apparel-focused (yoga pants, athletic tops), which aligns with Target's merchandising strength. **Hypothesis**: The old delivery may have used FOP labels that emphasized performance/technical attributes, inadvertently excluding mass-market training apparel sold at Target/Kohl's.

---

## Question 7: Merchant Market Share Distribution in Running (Original Delivery Scope)
*Raw question: Market share analysis for Running*

### Reasoning
Analyzing the competitive landscape for Running across all merchants, restricted to the months and merchants present in the original "old" delivery to isolate data version effects.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%running%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| dicks_sporting_goods |           33.18 |           11.29 |       -21.89 |
| nike                 |           29.62 |           36.13 |         6.52 |
| academy_sports       |           12.41 |           13.97 |         1.56 |
| kohls                |            8.81 |           13.2  |         4.39 |
| hoka                 |            8.41 |           10.74 |         2.33 |
| foot_locker          |            2.61 |            2.98 |         0.37 |
| target               |            2.07 |            2.53 |         0.46 |
| on                   |            1.72 |            7.9  |         6.18 |
| champs_sports        |            0.97 |            1.13 |         0.16 |
| kids_foot_locker     |            0.2  |            0.12 |        -0.08 |

### Visualization
![Merchant Market Share Distribution in Running (Original Delivery Scope)](images/merchant_running_shares.png)

### Summary Analysis
**Dick's Sporting Goods Running Share Collapse**: Dick's lost 21.89 percentage points in Running (33.18% → 11.29%), the largest single-merchant decline observed across all categories. Nike gained 6.52 points, but specialty running brands are the real winners: Hoka (+2.33 points), On (+6.18 points), and Kohls (+4.39 points). **Implications for Data Quality**: Dick's has now lost 13-22 points in three consecutive categories (Basketball, Sportswear, Running). This is no longer category-specific—it points to a fundamental change in how Dick's transactions are being measured. **Recommendation**: Audit the attribution logic for Dick's Sporting Goods. The new version may be (1) correctly routing brand-labeled products to their respective merchants (Nike, Hoka, On), leaving Dick's with only private-label, or (2) there's a technical error causing under-attribution.

---

## Question 8: Merchant Market Share Distribution in Basketball (Original Delivery Scope)
*Raw question: Market share analysis for Basketball*

### Reasoning
Analyzing the competitive landscape for Basketball across all merchants, restricted to the months and merchants present in the original "old" delivery to isolate data version effects.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%basketball%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| nike                 |           34.35 |           25.21 |        -9.14 |
| dicks_sporting_goods |           33.07 |           16.54 |       -16.53 |
| academy_sports       |            8.96 |            6.89 |        -2.07 |
| foot_locker          |            8    |            8.58 |         0.58 |
| kohls                |            7.01 |           28.15 |        21.13 |
| champs_sports        |            3.84 |            3.88 |         0.05 |
| target               |            3.29 |            9.32 |         6.03 |
| kids_foot_locker     |            1.47 |            1.19 |        -0.27 |
| on                   |            0.01 |            0.24 |         0.23 |

### Visualization
![Merchant Market Share Distribution in Basketball (Original Delivery Scope)](images/merchant_basketball_shares.png)

### Summary Analysis
**Kohl's Basketball Windfall**: Kohl's gained 21.13 percentage points (7.01% → 28.15%), the largest gain observed for this merchant in any category. Dick's lost 16.53 points, and Nike lost 9.14 points. **Data Quality Red Flag**: Kohl's is not traditionally known as a basketball powerhouse, yet the new data positions it as the #1 merchant. This is suspect. Possible scenarios: (1) The new version is capturing Kohl's Nike/Jordan partnerships that were previously uncategorized, (2) There's a classification error where basketball-themed casual wear (graphic tees with NBA logos) is being counted as "Basketball" product, inflating Kohl's totals. **Validation Needed**: Cross-reference Kohl's Basketball GMV with their public earnings reports—if this spike is real, it should appear in their merchandising mix disclosures.

---

## Question 9: Merchant Market Share Distribution in Hiking (Original Delivery Scope)
*Raw question: Market share analysis for Hiking*

### Reasoning
Analyzing the competitive landscape for Hiking across all merchants, restricted to the months and merchants present in the original "old" delivery to isolate data version effects.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%hiking%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| academy_sports       |           33.55 |           23.84 |        -9.71 |
| dicks_sporting_goods |           28.87 |           32.12 |         3.26 |
| kohls                |           25.67 |           29.35 |         3.68 |
| target               |            7.16 |           10.09 |         2.93 |
| nike                 |            2.74 |            1.95 |        -0.8  |
| hoka                 |            1.67 |            1.03 |        -0.64 |
| foot_locker          |            0.23 |            0.45 |         0.22 |
| champs_sports        |            0.08 |            0.25 |         0.16 |
| kids_foot_locker     |            0.02 |            0.12 |         0.1  |
| on                   |            0    |            0.81 |         0.81 |

### Visualization
![Merchant Market Share Distribution in Hiking (Original Delivery Scope)](images/merchant_hiking_shares.png)

### Summary Analysis
**Hiking Shows Moderate Stability**: Academy Sports lost 9.71 points (33.55% → 23.84%), while Dick's Sporting Goods and Kohl's each gained 3-4 points. The shifts here are notably smaller than other categories (no merchant moved >10 points). **Why This Matters**: Hiking may serve as a "control group" for understanding the data quality issues. Unlike Sportswear/Training (mass-market categories prone to definition ambiguity), Hiking has clearer product boundaries (boots, technical outerwear, backpacks). The relative stability suggests: (1) Hiking was already well-measured in the old version, or (2) The category size is small enough that merchant-level attribution errors are less impactful. **Insight**: Use Hiking trends as a baseline—categories with >2x the volatility of Hiking should be flagged for attribution investigation.

---

## Question 10: Merchant Market Share in Sportswear Apparel (Valid L2, Original Scope)
*Raw question: Market share analysis for Sportswear in Apparel with valid L2*

### Reasoning
Analyzing merchant competition for Sportswear within Apparel, filtering for valid L2 categories (excluding "Other Apparel"), and restricting to months/merchants present in both the "old" and "new" deliveries.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%sportswear%'
          AND LOWER(t.l1) = 'apparel'
          AND t.l2 IS NOT NULL
          AND LOWER(t.l2) NOT LIKE '%other%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| kohls                |           24.61 |           29.63 |         5.02 |
| dicks_sporting_goods |           24.2  |            9.53 |       -14.67 |
| nike                 |           20.52 |           10.49 |       -10.04 |
| target               |           12.93 |           42.56 |        29.63 |
| academy_sports       |           10.9  |            4.47 |        -6.43 |
| foot_locker          |            3.4  |            1.62 |        -1.78 |
| champs_sports        |            2.9  |            1.43 |        -1.48 |
| kids_foot_locker     |            0.52 |            0.28 |        -0.24 |
| hoka                 |            0    |            0    |        -0    |
| on                   |            0    |            0    |        -0    |

### Visualization
![Merchant Market Share in Sportswear Apparel (Valid L2, Original Scope)](images/apparel_sportswear_shares.png)

### Summary Analysis
**Apparel Sportswear: Target's Massive Expansion Continues**: When filtering to Apparel-only with valid L2 categories, Target's share jumps from 12.93% to 42.56% (+29.63 points), while Dick's drops from 24.20% to 9.53% (-14.67 points) and Nike falls from 20.52% to 10.49% (-10.04 points). **Critical Observation**: Target's gain in Apparel Sportswear (+29.63 points) is even larger than in overall Sportswear (+19.67 points). This confirms the attribution shift is apparel-focused, not footwear. **Business Context**: Target's activewear private labels (All in Motion launched 2020, JoyLab) have been publicly reported as billion-dollar brands. The new data finally reflects this, while the old version was likely misclassifying Target's apparel as generic "Sportswear" without merchant attribution. **Recommendation**: Segment future reports by L1 (Apparel vs. Footwear) to isolate these effects.

---

## Question 11: Merchant Market Share in Training Apparel (Valid L2, Original Scope)
*Raw question: Market share analysis for Training in Apparel with valid L2*

### Reasoning
Analyzing merchant competition for Training within Apparel, filtering for valid L2 categories (excluding "Other Apparel"), and restricting to months/merchants present in both the "old" and "new" deliveries.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%training%'
          AND LOWER(t.l1) = 'apparel'
          AND t.l2 IS NOT NULL
          AND LOWER(t.l2) NOT LIKE '%other%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| dicks_sporting_goods |           28.62 |           13.65 |       -14.96 |
| target               |           25.83 |           49.51 |        23.68 |
| kohls                |           22.67 |           27.08 |         4.41 |
| academy_sports       |           11.01 |            4.61 |        -6.4  |
| nike                 |           10.65 |            4.84 |        -5.82 |
| foot_locker          |            0.59 |            0.16 |        -0.44 |
| champs_sports        |            0.54 |            0.15 |        -0.39 |
| kids_foot_locker     |            0.08 |            0.01 |        -0.07 |
| hoka                 |            0.01 |            0    |        -0.01 |
| on                   |            0    |            0    |        -0    |

### Visualization
![Merchant Market Share in Training Apparel (Valid L2, Original Scope)](images/apparel_training_shares.png)

### Summary Analysis
**Training Apparel: Target Approaches 50% Market Share**: Target's share in Training Apparel increased from 25.83% to 49.51% (+23.68 points), just shy of an outright majority. Dick's Sporting Goods fell from 28.62% to 13.65% (-14.96 points). **Pattern Confirmation**: This is the third consecutive question where Target has gained 20-30 points in an apparel-focused category. The pattern is now undeniable—the old delivery systematically under-represented Target's athletic apparel market position. **Competitive Intelligence Insight**: If the new data is accurate, Target has emerged as the dominant force in mass-market training apparel, surpassing traditional sporting goods retailers. This has significant implications for brand strategy—athletic brands should prioritize Target partnerships.

---

## Question 12: Merchant Market Share in Basketball Apparel (Valid L2, Original Scope)
*Raw question: Market share analysis for Basketball in Apparel with valid L2*

### Reasoning
Analyzing merchant competition for Basketball within Apparel, filtering for valid L2 categories (excluding "Other Apparel"), and restricting to months/merchants present in both the "old" and "new" deliveries.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%basketball%'
          AND LOWER(t.l1) = 'apparel'
          AND t.l2 IS NOT NULL
          AND LOWER(t.l2) NOT LIKE '%other%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| nike                 |           28.39 |           11.19 |       -17.2  |
| dicks_sporting_goods |           25.28 |           21.19 |        -4.09 |
| kohls                |           24.95 |           41.25 |        16.3  |
| academy_sports       |           10.25 |            8.58 |        -1.67 |
| foot_locker          |            4.09 |            1.37 |        -2.72 |
| champs_sports        |            3.07 |            2.08 |        -0.99 |
| target               |            3.06 |           14.08 |        11.02 |
| kids_foot_locker     |            0.91 |            0.26 |        -0.65 |

### Visualization
![Merchant Market Share in Basketball Apparel (Valid L2, Original Scope)](images/apparel_basketball_shares.png)

### Summary Analysis
**Basketball Apparel: Nike's Catastrophic Collapse**: Nike's share in Basketball Apparel plummeted from 28.39% to 11.19% (-17.20 points), while Kohl's surged from 24.95% to 41.25% (+16.30 points) and Target jumped from 3.06% to 14.08% (+11.02 points). **This Does Not Pass the Smell Test**: Nike losing 17 points in Basketball Apparel—where they have Jordan Brand dominance—suggests a severe classification problem. **Competing Hypotheses**: (1) The new version is correctly attributing Nike/Jordan product sold *through* Kohl's/Target to those retailers (channel attribution), whereas the old version used brand attribution, or (2) There's a taxonomy error where basketball-themed casualwear is being over-weighted. **Action Required**: Before trusting these numbers, validate what's in the "Basketball Apparel" bucket—are we measuring performance basketball gear, or NBA-logo t-shirts?

---

## Question 13: Merchant Market Share in Hiking Apparel (Valid L2, Original Scope)
*Raw question: Market share analysis for Hiking in Apparel with valid L2*

### Reasoning
Analyzing merchant competition for Hiking within Apparel, filtering for valid L2 categories (excluding "Other Apparel"), and restricting to months/merchants present in both the "old" and "new" deliveries.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%hiking%'
          AND LOWER(t.l1) = 'apparel'
          AND t.l2 IS NOT NULL
          AND LOWER(t.l2) NOT LIKE '%other%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| kohls                |           33.7  |           30.34 |        -3.35 |
| dicks_sporting_goods |           29.64 |           34.81 |         5.17 |
| academy_sports       |           23.36 |           23.78 |         0.42 |
| target               |            9.34 |           10.16 |         0.82 |
| nike                 |            3.57 |            0.72 |        -2.85 |
| foot_locker          |            0.25 |            0.09 |        -0.15 |
| champs_sports        |            0.11 |            0.09 |        -0.01 |
| kids_foot_locker     |            0.03 |            0.01 |        -0.02 |
| hoka                 |            0.01 |            0    |        -0.01 |

### Visualization
![Merchant Market Share in Hiking Apparel (Valid L2, Original Scope)](images/apparel_hiking_shares.png)

### Summary Analysis

**Hiking Apparel: Relative Stability**: The largest move in Hiking Apparel is Dick's Sporting Goods gaining 5.17 points (29.64% → 34.81%). All other merchants moved less than 4 points. **Why This Is Significant**: After seeing 15-30 point swings in other Apparel categories, Hiking's stability is notable. This supports the hypothesis from Question 9—Hiking is a more clearly-defined category with less classification ambiguity. **Managerial Implication**: When presenting to stakeholders, use Hiking as the "control" to demonstrate that the large swings in Sportswear/Training/Basketball are category-specific issues, not universal data quality problems. Hiking's consistency validates that the overall data collection methodology is sound.

---

## Question 14: Merchant Market Share in Cheer/Dance Apparel (Valid L2, Original Scope)
*Raw question: Market share analysis for Cheer/Dance in Apparel with valid L2*

### Reasoning
Analyzing merchant competition for Cheer/Dance within Apparel, filtering for valid L2 categories (excluding "Other Apparel"), and restricting to months/merchants present in both the "old" and "new" deliveries.

### SQL Query
```sql

    WITH scope AS (
        SELECT DISTINCT month, merchant 
        FROM trends 
        WHERE source = 'old'
    ),
    filtered_data AS (
        SELECT 
            t.source,
            t.merchant,
            t.gmv
        FROM trends t
        JOIN scope s ON t.month = s.month AND t.merchant = s.merchant
        WHERE LOWER(t.fop) LIKE '%cheer%'
          AND LOWER(t.l1) = 'apparel'
          AND t.l2 IS NOT NULL
          AND LOWER(t.l2) NOT LIKE '%other%'
    ),
    totals AS (
        SELECT source, SUM(gmv) as total_gmv
        FROM filtered_data
        GROUP BY source
    ),
    shares AS (
        SELECT 
            d.merchant,
            d.source,
            SUM(d.gmv) * 100.0 / t.total_gmv as share
        FROM filtered_data d
        JOIN totals t ON d.source = t.source
        GROUP BY d.merchant, d.source, t.total_gmv
    )
    SELECT 
        merchant,
        ROUND(MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as old_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END), 2) as new_share_pct,
        ROUND(MAX(CASE WHEN source = 'new' THEN share ELSE 0 END) - MAX(CASE WHEN source = 'old' THEN share ELSE 0 END), 2) as share_diff
    FROM shares
    GROUP BY merchant
    ORDER BY MAX(CASE WHEN source = 'old' THEN share ELSE 0 END) DESC;
    
```

### Results

| merchant             |   old_share_pct |   new_share_pct |   share_diff |
|:---------------------|----------------:|----------------:|-------------:|
| target               |               0 |           43.72 |        43.72 |
| nike                 |               0 |            1.2  |         1.2  |
| kohls                |               0 |           50.68 |        50.68 |
| kids_foot_locker     |               0 |            0.01 |         0.01 |
| foot_locker          |               0 |            0.03 |         0.03 |
| dicks_sporting_goods |               0 |            2.58 |         2.58 |
| champs_sports        |               0 |            0.07 |         0.07 |
| academy_sports       |               0 |            1.71 |         1.71 |

### Visualization
![Merchant Market Share in Cheer/Dance Apparel (Valid L2, Original Scope)](images/apparel_cheer_dance_shares.png)

### Summary Analysis

**Cheer/Dance Apparel: Complete Data Blackout in Old Version**: Every merchant shows 0.00% market share in the old version, while the new version shows Kohl's at 50.68% and Target at 43.72%. **This Is a Smoking Gun**: Cheer/Dance Apparel was effectively non-existent in the old delivery when filtered to valid L2 categories. This confirms earlier suspicions from Question 2, where Cheer/Dance row counts exploded by 81x. **Root Cause**: The old version likely dumped all Cheer/Dance apparel into an "Other Apparel" L2 category, which we excluded from this analysis. **Data Quality Lesson**: This is why the "valid L2" filter exists—the old version was using "Other Apparel" as a catch-all for items with unclear classification. The new version has properly categorized these items into specific L2 buckets (likely Tops, Bottoms, Dresses), enabling actual analysis. **Trust Level**: Exercise caution with Cheer/Dance trends—while we now have data, we lack historical comparisons.

---
